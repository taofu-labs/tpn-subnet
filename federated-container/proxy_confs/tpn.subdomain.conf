# Non TLS server block (listens on port defined by SERVER_PUBLIC_PORT, default 3000)
server {
    # Listen on SERVER_PUBLIC_PORT environment variable (default: 3000)
    listen $SERVER_PUBLIC_PORT;
    listen [::]:$SERVER_PUBLIC_PORT;

    # Server name from SERVER_PUBLIC_HOST environment variable (default: _)
    server_name $SERVER_PUBLIC_HOST;
    client_max_body_size 0;

    location / {
        # Proxy configuration - edit these values as needed
        set $upstream_app $UPSTREAM_APP;
        set $upstream_port $UPSTREAM_PORT;
        set $upstream_proto http;

        # Import shared proxy confs
        include /config/nginx/shared.conf;

        proxy_pass $upstream_proto://$upstream_app:$upstream_port;
    }
}

# TLS server block (listens on 443 when SSL is configured)
server {
    listen 443 ssl http2;
    listen [::]:443 ssl http2;

    # Server name from SERVER_PUBLIC_HOST environment variable (default: _)
    server_name $SERVER_PUBLIC_HOST;

    include /config/nginx/ssl.conf;
    client_max_body_size 0;

    location / {
        # Proxy configuration - edit these values as needed
        set $upstream_app $UPSTREAM_APP;
        set $upstream_port $UPSTREAM_PORT;
        set $upstream_proto $UPSTREAM_PROTO;

        # Import shared proxy confs
        include /config/nginx/shared.conf;

        proxy_pass $upstream_proto://$upstream_app:$upstream_port;
    }
}
